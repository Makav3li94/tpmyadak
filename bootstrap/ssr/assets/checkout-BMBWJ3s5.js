import{jsx as e,jsxs as a,Fragment as F}from"react/jsx-runtime";import{Popover as V,PopoverButton as G,PopoverBackdrop as H,PopoverPanel as Q,RadioGroup as U,Radio as W}from"@headlessui/react";import{useEffect as j,useState as _}from"react";import{useCart as $}from"react-use-cart";import{ChevronUp as A,CheckCircleIcon as P}from"lucide-react";import{O as J}from"./order-layout-Csg-4_QI.js";import{useForm as z,usePage as K}from"@inertiajs/react";import{B as L}from"./button-s_fcD1op.js";import{u as X}from"./hooks-CFRBbKAZ.js";import{l as Y,T as w,a as Z,s as S}from"./textarea-input-CS_jPfHL.js";import"sonner";import"dayjs";import{M}from"./modal-Dg-qeh5M.js";import"theme-change";import"./logo-C8A0auOY.js";function ee(l){const{modalState:d,user:g,is_user:D=!1}=l,{data:n,setData:v,post:k,put:I,processing:h,errors:i,reset:b,clearErrors:o}=z({user_id:g.id,name:g.name,postal_code:"",m_code:"",mobile:g.mobile,phone:"",address:""});console.log(D);const c=s=>{v(s.target.name,s.target.type==="checkbox"?s.target.checked?1:0:s.target.value)},C=()=>{d.setData(null),b(),o()},m=()=>{C(),d.toggle()},f=s=>{s.preventDefault();const x=d.data;if(x!==null){I(route("admin.addresses.update",x),{onSuccess:()=>m()});return}const T=D?"home.address":"admin.addresses.store";k(route(T),{onSuccess:()=>m()})};return j(()=>{const s=d.data;Y.isEmpty(s)===!1&&v({user_id:s.user_id,name:s.name,postal_code:s.postal_code,m_code:s.m_code,mobile:s.mobile,phone:s.phone,address:s.address})},[d]),e(M,{isOpen:d.isOpen,onClose:m,title:"کاربران",children:a("form",{className:"form-control space-y-2.5",onSubmit:f,children:[e(w,{name:"name",value:n.name,onChange:c,label:"نام و نام خانوادگی",error:i.name}),e(w,{name:"postal_code",value:n.postal_code,onChange:c,label:"کدپستی",error:i.postal_code,maxLength:10}),e(w,{name:"m_code",value:n.m_code,onChange:c,label:"کدملی خریدار",maxLength:10,error:i.m_code}),e(w,{name:"mobile",value:n.mobile,onChange:c,label:"موبایل",maxLength:11,error:i.mobile}),e(w,{name:"phone",value:n.phone,onChange:c,label:"تلفن ثابت",maxLength:11,error:i.phone}),e(Z,{name:"address",value:n.address,label:"آدرس",onChange:c,error:i.address}),a("div",{className:"flex items-center space-x-2 mt-4 w-full justify-around",children:[e(L,{processing:h,btnType:"submit",type:"primary",children:"ذخیره"}),e(L,{onClick:m,type:"secondary",children:"انصراف"})]})]})})}function te({user:l,paymentMethods:d,shippingMethods:g}){const{props:{auth:D}}=K(),[n,v]=_(!1),[k,I]=_(0),[h,i]=_(0),b=X(),[o,c]=_(null),[C,m]=_(null),{items:f,updateItemQuantity:s,cartTotal:x,isEmpty:T}=$(),{processing:ae,data:N,setData:y,get:se,post:B}=z({items:f,address_id:"",payment_type:"online",payment_method_id:d[0].id,shipping_method_id:g[0].id,subtotal:"",discount:h,discount_id:null,total_cost:x}),E=(t=null)=>{b.setData(t),b.toggle()};function O(){let t=f.reduce((p,u)=>p=p+(u.discount===null?u.itemTotal:parseInt(u.price)*u.quantity),0),r=f.reduce((p,u)=>p=p+(u.discount===null?0:parseInt(u.discount)*u.quantity),0);y({...N,subtotal:t,discount:r}),I(t),i(r)}j(()=>{v(!1),O()},[s]),j(()=>{n||O(),v(!0)},[n]),j(()=>{},[C,o]);const q=t=>{if(t.preventDefault(),!(o===""||o.length!==8)){if(C!==null){S("کد تخفیف قبلا استفاده شده.","error");return}axios.get(route("home.discount",o)).then(r=>{r.data.status==="success"&&(m(r.data.discount),y("discount_id",r.data.discount.id),S("کد تخفیف اعمال شد.","success")),r.data.status==="error"&&(m(null),y("discount_id",null),S("کد تخفیف منقضی شده یا معتبر نیست.","error"))}).catch(r=>{m(null),y("discount_id",null),S("کد تخفیف منقضی شده یا معتبر نیست.","error"),console.error(r)})}},R=t=>{t.preventDefault(),B(route("home.order"),{onSuccess:()=>{}})};return a(F,{children:[e("h1",{className:"sr-only",children:"Order information"}),e("section",{"aria-labelledby":"summary-heading",className:" px-4 pb-10 pt-16 sm:px-6 lg:col-start-1 lg:row-start-1 lg:bg-transparent lg:px-0 lg:pb-16",children:a("div",{className:"mx-auto max-w-lg lg:max-w-none",children:[e("h2",{id:"summary-heading",className:"text-lg font-medium ",children:"صورتحساب"}),e("ul",{role:"list",className:"divide-y divide-gray-200 text-sm font-medium border-gray-100 ",children:n&&f.map((t,r)=>a("li",{className:"flex items-start space-x-4 py-6",children:[e("img",{alt:t.title,src:`http://cdn.tpmyadak.com/prothumb/${t.image}`,className:"h-20 w-20 flex-none rounded-md object-cover object-center"}),a("div",{className:"flex-auto space-y-1",children:[e("h3",{children:t.title}),t.size?e("p",{className:"text-gray-500",children:t.size}):null]}),a("p",{className:"flex-none text-base font-medium",children:[parseInt(t.price).toLocaleString("en")," تومان"]})]},r))}),a("form",{className:"my-10",children:[e("label",{htmlFor:"discount-code-mobile",className:"block text-sm font-medium ",children:"کد تخفیف"}),e("div",{className:"mt-1 flex space-x-4",children:a("div",{className:"join",children:[e("button",{className:"btn btn-neutral join-item",disabled:o===null||o.length===0,onClick:q,children:"اعمال"}),a("div",{children:[e("label",{className:"input validator join-item",children:e("input",{type:"text",placeholder:"tpm-",required:!0,dir:"ltr",onInvalid:t=>t.target.setCustomValidity("لطفا کد تخفیف را به درستی کنید."),onInput:t=>t.target.setCustomValidity(""),onChange:t=>c(t.target.value),name:"discount"})}),e("div",{className:"validator-hint hidden",children:"کد تخفیف را به درستی وارد کنید"})]})]})})]}),a("dl",{className:"hidden space-y-6 border-t border-gray-200 pt-6 text-sm font-medium  lg:block",children:[a("div",{className:"flex items-center justify-between",children:[e("dt",{className:"",children:"مجموع"}),a("dd",{children:["       ",k.toLocaleString("en")]})]}),a("div",{className:"flex items-center justify-between",children:[e("dt",{className:"",children:"تخفیف"}),a("dd",{children:["   ",h.toLocaleString("en")]})]}),a("div",{className:"flex items-center justify-between border-t border-gray-200 pt-6",children:[e("dt",{className:"text-base",children:"قابل پرداخت"}),e("dd",{className:"text-base",children:parseInt(x-h).toLocaleString("en")})]})]}),a(V,{className:"fixed inset-x-0 bottom-0 flex flex-col-reverse text-sm font-medium  bg-base-100 lg:hidden",children:[e("div",{className:"relative z-9999 border-t border-gray-200  px-4 sm:px-6",children:e("div",{className:"mx-auto max-w-lg",children:a(G,{className:"flex w-full items-center py-6 font-medium",children:[e("span",{className:"mr-auto text-base",children:"قابل پرداخت"}),a("span",{className:"mr-2 text-base",children:[" ",parseInt(x-h).toLocaleString("en")]}),e(A,{"aria-hidden":"true",className:"h-5 w-5 text-gray-500"})]})})}),e(H,{transition:!0,className:"fixed inset-0 bg-black bg-opacity-25 transition-opacity duration-300 ease-linear data-[closed]:opacity-0"}),e(Q,{transition:!0,className:"relative transform bg-base-100 px-4 py-6 transition duration-300 ease-in-out data-[closed]:translate-y-full sm:px-6",children:a("dl",{className:"mx-auto max-w-lg space-y-6",children:[a("div",{className:"flex items-center justify-between",children:[e("dt",{className:"",children:"مجموع"}),a("dd",{children:[" ",k.toLocaleString("en")]})]}),a("div",{className:"flex items-center justify-between",children:[e("dt",{className:"",children:"تخفیف"}),a("dd",{children:[" ",h.toLocaleString("en")]})]})]})})]})]})}),e("form",{className:"px-4 pb-36 pt-16 sm:px-6 lg:col-start-2 lg:row-start-1 lg:px-0 lg:pb-16",onSubmit:R,children:a("div",{className:"mx-auto max-w-lg lg:max-w-none",children:[e("section",{"aria-labelledby":"contact-info-heading",children:e("h2",{id:"contact-info-heading",className:"text-lg font-medium ",children:"اطلاعات تحویل"})}),l&&l.addresses&&l.addresses.length>0?l.addresses.map((t,r)=>e("div",{className:"mt-2  bg-base-100 card-sm shadow-sm mb-2",children:a("div",{className:"card-body",children:[a("h2",{className:"card-title",children:["آدرس ",++r]}),e("p",{children:t.name}),e("p",{children:t.postal_code}),e("p",{children:t.mobile}),e("p",{children:t.phone}),e("p",{children:t.address}),e("div",{className:"justify-end card-actions",children:e("button",{className:"btn btn-primary",disabled:N.address_id===t.id,onClick:p=>{p.preventDefault(),y("address_id",t.id)},children:"انتخاب به عنوان گیرنده"})}),N.address_id===t.id&&e(P,{"aria-hidden":"true",className:"h-5 w-5 text-indigo-600 absolute top-2 left-2"})]})})):a("div",{role:"alert",className:"alert alert-warning alert-dash mt-5",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 shrink-0 stroke-current",fill:"none",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e("span",{children:"آدرسی موجود نیست."})]}),e(L,{className:"mt-5",type:"info",onClick:()=>E(),children:"افزودن آدرس"}),e("div",{className:"mt-10 border-t border-gray-200 pt-10",children:a("fieldset",{children:[e("legend",{className:"text-lg font-medium ",children:"نحوه ارسال"}),e(U,{value:N.shipping_method_id,onChange:()=>y("shipping_method_id"),className:"mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-4 z-0",children:g.map((t,r)=>a(W,{value:t.id,"aria-label":t.title,defaultChecked:r===0,className:"group  relative flex cursor-pointer rounded-lg border border-gray-300 bg-base-100 p-4 shadow-sm focus:outline-none data-[checked]:border-transparent data-[focus]:ring-2 data-[focus]:ring-indigo-500",children:[e("span",{className:"flex flex-1",children:a("span",{className:"flex flex-col",children:[e("span",{className:"block text-sm font-medium ",children:t.title}),e("span",{className:"mt-2 flex items-center text-sm text-gray-500",children:"1 تا 3 روز"}),e("span",{className:"mt-6 text-sm font-medium ",children:t.cost})]})}),e(P,{"aria-hidden":"true",className:"h-5 w-5 text-indigo-600 [.group:not([data-checked])_&]:hidden"}),e("span",{"aria-hidden":"true",className:"pointer-events-none absolute -inset-px rounded-lg border-2 border-transparent group-data-[focus]:border group-data-[checked]:border-indigo-500"})]},t.id))})]})}),a("div",{className:"mt-10 border-t border-gray-200 pt-10",children:[e("h2",{className:"text-lg font-medium ",children:"نحوه پرداخت"}),a("fieldset",{className:"mt-4",children:[e("legend",{className:"sr-only",children:"متد پرداخت"}),e("div",{className:"space-y-4 sm:flex sm:items-center sm:space-x-10 sm:space-y-0",children:d.map((t,r)=>a("div",{className:"flex items-center",children:[r===0?e("input",{defaultChecked:!0,id:t.id,name:"payment-type",type:"radio",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"}):e("input",{id:t.id,name:"payment-type",disabled:!0,type:"radio",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e("label",{htmlFor:t.id,className:"mr-3 block text-sm font-medium ",children:t.title})]},t.id))})]})]}),a("div",{className:"mt-10 border-t border-gray-200 pt-6 sm:flex sm:items-center sm:justify-between",children:[e(L,{disabled:N.address_id==="",type:"error",btnType:"submit",children:"ثبت سفارش و پرداخت"}),N.address_id===""?e(F,{children:l.addresses.length===0?e("p",{className:"mt-4 text-center text-sm text-red-500 sm:mt-0 sm:text-left",children:"لطفا ابتدا یک آدرس تحویل ثبت کنید."}):e("p",{className:"mt-4 text-center text-sm text-info/50-500 sm:mt-0 sm:text-left",children:"لطفا آدرس تحویل را انتخاب کنید."})}):e("p",{className:"mt-4 text-center text-sm text-gray-500 sm:mt-0 sm:text-left",children:"ادامه خرید ..."})]})]})}),b.isOpen&&e(ee,{modalState:b,user:l,is_user:!0})]})}te.layout=l=>e(J,{children:l});export{te as default};
