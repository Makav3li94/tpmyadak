import{jsxs as s,Fragment as z,jsx as r}from"react/jsx-runtime";import{F as G}from"./front-layout-HCOsmJC9.js";import{router as x,Head as K,Link as Q}from"@inertiajs/react";import{useState as c,useCallback as X,useEffect as v,useRef as k}from"react";import{P as Y}from"./product-card-5AG3KAUT.js";import{useCart as Z}from"react-use-cart";import{s as F}from"./textarea-input-CS_jPfHL.js";import{B as $}from"./breadcrumb-BjIIdQz3.js";import ee from"./list-sidebar-CoWFHJYG.js";import{u as re,P as te,N as se}from"./carousalArrowButtons-DXZfx4kV.js";import ae from"embla-carousel-react";import oe from"embla-carousel-autoplay";import"./hooks-CFRBbKAZ.js";import"theme-change";import"./header-single-DBb2n_1D.js";import"lucide-react";import"./logo-C8A0auOY.js";import"motion/react";import"./button-s_fcD1op.js";import"sonner";import"dayjs";import"./top-nav-BOQ99mTu.js";import"./feature-QeK4Uxmd.js";import"./badge-DHrEAO1i.js";import"./MultiRangeSlider-BON0lKoX.js";import"./searchFilter-B8iKzvDk.js";import"@headlessui/react";const le=a=>{const[t,i]=c(0),[g,h]=c(0),n=X(u=>{h(u.scrollSnapList().length),i(u.selectedScrollSnap())},[]);return v(()=>{a&&(n(a),a.on("select",n),a.on("reInit",n))},[a,n]),{selectedSnap:t,snapCount:g}},ne=a=>{const{selectedSnap:t,snapCount:i}=a;return s("div",{className:"embla__selected-snap-display",children:[t+1," / ",i]})};function ce(a){const{data:t={},brands:i=null,carBrands:g=null,carModels:h=null,categories:n=null,filters:u=null,productCategory:o}=a,[j,N]=c(Array.isArray(t.data)?t.data:[]),[p,S]=c(t.next_page_url||null),[f,y]=c(!!t.next_page_url),[m,_]=c(!1),b=k(null),d=k(null);v(()=>{const e=Array.isArray(t.data)?t.data:[];N(e),S(t.next_page_url||null),y(!!t.next_page_url)},[o.slug,route().params.column,route().params.in_stock,route().params.has_promotion,route().params.priceMin,route().params.priceMax,JSON.stringify(route().params.staticFilters),JSON.stringify(route().params.dynamicFilters)]),v(()=>{if(!(!b.current||!f))return d.current&&d.current.disconnect(),d.current=new IntersectionObserver(e=>{e[0].isIntersecting&&!m&&p&&L()},{root:null,rootMargin:"200px",threshold:.1}),d.current.observe(b.current),()=>d.current?.disconnect()},[p,m,f]);const L=()=>{!p||m||!f||(_(!0),x.get(p,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:e=>{const l=e.props?.data?.data||[];N(V=>{const q=[...V,...l],B=new Set;return q.filter(w=>{const P=w?.id??JSON.stringify(w);return B.has(P)?!1:(B.add(P),!0)})}),S(e.props?.data?.next_page_url||null),y(!!e.props?.data?.next_page_url)},onFinish:()=>{_(!1)}}))},{addItem:M}=Z(),D=route().params.column||"created_at,desc",[I,C]=ae({align:"start",direction:"rtl",loop:!0},[oe()]),{prevBtnDisabled:O,nextBtnDisabled:R,onPrevButtonClick:A,onNextButtonClick:J}=re(C),{selectedSnap:E,snapCount:H}=le(C),U=e=>{const l=e.target.value;x.get(route(route().current(),o.slug),{...route().params,column:l},{replace:!0,preserveScroll:!0,preserveState:!0})},W=e=>{M({id:e.id,sku:e.sku,title:e.title,excerpt:e.excerpt,discount:e.discount,image:e.image,price:e.price}),F("محصول به سبد خرید اضافه شد","success")},T=e=>{x.post(route("user.wishlists.store"),{item:e},{forceFormData:!0,onSuccess:()=>F("محصول به لیست خرید اضافه شد","success")})};return s(z,{children:[r(K,{title:"محصولات "+o.title}),r($,{l1:["دسته بندی",""],l2:[o.title,""]}),r("section",{className:"w-full container justify-center mb-12",children:s("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[r(ee,{brands:i,carBrands:g,carModels:h,categories:n,filters:u,routeParam:o.slug}),s("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[s("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",o.title]}),o.children?.length>0&&s("section",{className:"bembla relative",children:[r("div",{className:"bembla__viewport",ref:I,children:r("div",{className:"bembla__container",children:o.children.map((e,l)=>r("div",{className:"bembla__slide pl-0",children:s("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[r("figure",{children:r("img",{src:e.image?route("file.show",{file:e.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),s("div",{className:"card-body text-center p-1 mt-2",children:[r(Q,{href:route("home.getCategory",e.slug),children:r("h2",{className:"card-title justify-center text-sm",children:e.title})}),e.description&&r("p",{children:e.description})]})]})},l))})}),s("div",{className:"bembla__controls",children:[s("div",{className:"bembla__buttons jobjob",children:[r(te,{onClick:A,disabled:O}),r(se,{onClick:J,disabled:R})]}),r(ne,{selectedSnap:E,snapCount:H})]})]}),s("div",{className:"my-8 text-left",children:[r("label",{htmlFor:"cars",children:"مرتب سازی"}),s("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:D,onChange:U,children:[r("option",{value:["created_at","desc"],children:"جدیدترین"}),r("option",{value:["price","asc"],children:"ارزانترین"}),r("option",{value:["price","desc"],children:"گرانترین"})]})]}),r("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:j.map((e,l)=>r(Y,{product:e,handleAdd:()=>W(e),handleWish:()=>T(e)},l))}),r("div",{ref:b,className:"h-12"}),m&&r("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),r("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}ce.layout=a=>r(G,{isSingle:!0,children:a});export{ce as default};
