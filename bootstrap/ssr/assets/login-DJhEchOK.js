import{jsxs as c,jsx as t,Fragment as V}from"react/jsx-runtime";import{useState as a,useEffect as y}from"react";import{G as A}from"./guest-layout-CFrYZd0A.js";import{useForm as O,Head as _,router as q}from"@inertiajs/react";import{T as m,s as x}from"./textarea-input-CS_jPfHL.js";import{B as p}from"./button-s_fcD1op.js";import"sonner";import"theme-change";import"./LandingIntro--Bkw8jbr.js";import"./TemplatePointers-CrKqY3VS.js";import"lucide-react";import"dayjs";function ne({status:z}){const{data:s,setData:C,post:N,processing:v,errors:f,reset:M}=O({mobile:"09",name:"",email:"",code:"",password:""}),[b,E]=a(!1),[F,B]=a(null),[D,P]=a(!1),[h,j]=a(!1),[k,d]=a(null),[J,g]=a(null),[Q,l]=a(!1),[U,R]=a(""),[o,S]=a(30);y(()=>{let e,r;if(o>0)e=setInterval(()=>S(n=>n-1),1e3);else if(o===0)return;return()=>{clearTimeout(r),clearInterval(e)}},[o]),y(()=>()=>{M("password")},[]),y(()=>{s.code!==null&&s.code.length===4&&I()},[s.code]);const I=e=>{if(s.code===null)return!1;if(g(""),parseInt(F)!==parseInt(G(s.code)))g("کد وارد شده اشتباه است."),l(!0);else return g(null),l(!1),!0},G=e=>e.replace(/[٠-٩۰-۹]/g,r=>r.charCodeAt(0)&15),i=e=>{C(e.target.name,e.target.type==="checkbox"?e.target.checked:e.target.value)},H=e=>{e.code==="Enter"&&N(route("login"))},K=e=>{if(C("password",""),e.user==="True"){x("رمز عبور جدید برای شما ارسال شد.","success"),R(e.statusMessage),console.log(e.pass),j(!0);return}if(e.user==="False"){if(e.sms_active==="yes"){x("کد با موفقیت ارسال شد.","success");const r=(parseInt(e.code)-parseInt(s.mobile)*100/2)/1363;console.log(r),B(r)}else E(!0);P(!0)}},w=async(e,r="login")=>{if(e.preventDefault(),l(!0),d(null),r==="login"||r==="resend"){if(S(45),!h||r==="resend")try{d(null);const u=(await axios.get(route("phoneStat",{mobile:s.mobile}))).data;if(K(u),u.errs&&Object.keys(u.errs).length!==0){const T=u.errs;T.mobile&&d(T.mobile)}}catch(n){console.log(n)}finally{l(!1)}else{if(!s.password||s.password.length!==6){x("لطفا رمز را به درستی وارد کنید.","error"),l(!1);return}q.post(route("login"),{email:s.email,mobile:s.mobile,password:s.password,norm:!0},{onStart:()=>l(!0),onFinish:()=>l(!1),onError:()=>d("شماره همراه یا رمز عبور اشتباه می باشد.")})}return}try{if(!b&&!I())return l(!1),!1}catch(n){console.log(n)}finally{l(!1)}},L=e=>{e.preventDefault(),N(route("registerPost",{code:s.code,name:s.name,mobile:s.mobile,email:s.email,password:s.password}))};return c(A,{children:[t(_,{title:"ورود | ثبت نام"}),t("h2",{className:"text-2xl font-semibold mb-2 text-center",children:"ورود | ثبت نام"}),D?c("form",{onSubmit:e=>L(e),children:[t("div",{className:"mb-4",children:t(m,{type:"text",label:"نام و نام خانوادگی",name:"name",value:s.name,className:"mt-1 block w-full",onChange:i,error:f.name})}),t("div",{className:"mb-4",children:t(m,{type:"text",label:"ایمیل",name:"email",value:s.email,className:"mt-1 block w-full",onChange:i,error:f.email})}),!b&&t("div",{className:"mb-4",children:t(m,{type:"code",label:"کدتایید",name:"code",value:s.code,className:"mt-1 block w-full",onChange:i,error:f.code})}),t(p,{btnType:"submit",processing:v,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ثبت نام"}),!b&&c(p,{type:"error",className:"btn mt-5 w-full ",onClick:e=>w(e,"resend"),disabled:o!==0,children:["ارسال مجدد پیامک",t("strong",{className:"text-danger mr-2",children:o!==0?o:""})]})]}):c("form",{onSubmit:e=>w(e,"login"),children:[h?t(V,{children:t("div",{className:"mb-4",children:t(m,{type:"password",label:"رمزعبور",name:"password",dir:"ltr",placeholder:"password",value:s.password,className:"mt-1 block w-full",onChange:i,error:k,onKeyDownCapture:H})})}):t("div",{className:"mb-4",children:t(m,{type:"text",label:"موبایل",name:"mobile",placeholder:"+۹۸",pattern:"\\d{11}",value:s.mobile,className:"mt-1 block w-full",dir:"ltr",maxLength:11,autoFocus:!0,onChange:i,error:k})}),t(p,{btnType:"submit",processing:v,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ورود"}),h&&c(p,{type:"error",className:"btn mt-5 w-full ",onClick:e=>w(e,"login"),disabled:o!==0,children:["ارسال مجدد پیامک",t("strong",{className:"text-danger mr-2",children:o!==0?o:""})]})]}),t("p",{className:" text-center  text-xs mt-5",children:"با ورود به سایت قوانین و مقررات را میپذیرم."})]})}export{ne as default};
