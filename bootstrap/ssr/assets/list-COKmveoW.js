import{jsxs as s,Fragment as Z,jsx as r}from"react/jsx-runtime";import{F as V}from"./front-layout-DzdeP-Wv.js";import{router as _,Link as ee}from"@inertiajs/react";import{useState as o,useCallback as re,useEffect as C,useRef as R}from"react";import{P as te}from"./product-card-DnH9NfKK.js";import{useCart as se}from"react-use-cart";import{s as U}from"./textarea-input-CS_jPfHL.js";import{B as ne}from"./breadcrumb-BjIIdQz3.js";import le from"./list-sidebar-CXQpIq2d.js";import{u as oe,P as ae,N as ce}from"./carousalArrowButtons-DXZfx4kV.js";import ie from"embla-carousel-react";import de from"embla-carousel-autoplay";import{C as ue}from"./card-BmfKSUuz.js";import"sonner";import"./hooks-CFRBbKAZ.js";import"theme-change";import"./header-single-CWe01uzl.js";import"lucide-react";import"./logo-C8A0auOY.js";import"motion/react";import"./button-s_fcD1op.js";import"dayjs";import"./megu-menu-CsbLbF7s.js";import"./feature-QeK4Uxmd.js";import"./badge-DHrEAO1i.js";import"./MultiRangeSlider-BON0lKoX.js";import"./searchFilter-B8iKzvDk.js";import"@headlessui/react";const me=n=>{const[l,u]=o(0),[b,x]=o(0),a=re(h=>{x(h.scrollSnapList().length),u(h.selectedScrollSnap())},[]);return C(()=>{n&&(a(n),n.on("select",a),n.on("reInit",a))},[n,a]),{selectedSnap:l,snapCount:b}},pe=n=>{const{selectedSnap:l,snapCount:u}=n;return s("div",{className:"embla__selected-snap-display",children:[l+1," / ",u]})};function he(n){const{data:l={},brands:u=null,carBrands:b=null,carModels:x=null,categories:a=null,filters:h=null,productCategory:c}=n,D=Array.isArray(l.data)?l.data:[],v=l.next_page_url??null,S=l.next_cursor??null,[I,M]=o(D),[f,i]=o(null),[g,w]=o(!1),[N,d]=o(!!(v||S)),y=R(null),m=R(null);function P(e){if(!e)return null;const t=new URL(window.location.href),p=new URLSearchParams(t.search);return p.delete("cursor"),p.set("cursor",e),`${t.pathname}?${p.toString()}`}C(()=>{if(v){i(v),d(!0);return}if(S){i(P(S)),d(!0);return}i(null),d(!1)},[]),C(()=>{if(!(!y.current||!N))return m.current&&m.current.disconnect(),m.current=new IntersectionObserver(e=>{e[0].isIntersecting&&!g&&f&&j()},{root:null,rootMargin:"200px",threshold:.1}),m.current.observe(y.current),()=>m.current?.disconnect()},[f,g,N]);const j=()=>{!f||g||!N||(w(!0),_.get(f,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:e=>{const t=e.props?.data??{},p=Array.isArray(t.data)?t.data:[];M(X=>{const Y=[...X,...p],L=new Set;return Y.filter(k=>{const F=k?.id??JSON.stringify(k);return L.has(F)?!1:(L.add(F),!0)})}),t.next_page_url?(i(t.next_page_url),d(!0)):t.next_cursor?(i(P(t.next_cursor)),d(!0)):(i(null),d(!1))},onFinish:()=>w(!1)}))},{addItem:A}=se(),[E,O]=o(""),[W,B]=ie({align:"start",direction:"rtl",loop:!0},[de()]),{prevBtnDisabled:$,nextBtnDisabled:H,onPrevButtonClick:J,onNextButtonClick:T}=oe(B),{selectedSnap:q,snapCount:z}=me(B),G=e=>{O(e.target.value),_.get(route(route().current(),c.slug),{column:e.target.value},{replace:!0,preserveState:!0,preserveScroll:!0})},K=e=>{A({id:e.id,sku:e.sku,title:e.title,excerpt:e.excerpt,discount:e.discount,image:e.image,price:e.price}),U("محصول به سبد خرید اضافه شد","success")},Q=e=>{_.post(route("user.wishlists.store"),{item:e},{forceFormData:!0,onSuccess:()=>U("محصول به لیست خرید اضافه شد","success")})};return s(Z,{children:[r(ne,{l1:["دسته بندی",""],l2:[c.title,""]}),r("section",{className:"w-full container justify-center mb-12",children:s("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[r(le,{brands:u,carBrands:b,carModels:x,categories:a,filters:h,routeParam:c.slug}),s("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[s("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",c.title]}),c.children?.length>0&&s("section",{className:"bembla relative",children:[r("div",{className:"bembla__viewport",ref:W,children:r("div",{className:"bembla__container",children:c.children.map((e,t)=>r("div",{className:"bembla__slide",children:s(ue,{children:[r("figure",{children:r("img",{src:e.image?route("file.show",{file:e.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),s("div",{className:"card-body text-center p-2",children:[r(ee,{href:route("home.getCategory",e.slug),children:r("h2",{className:"card-title justify-center text-sm",children:e.title})}),e.description&&r("p",{children:e.description})]})]})},t))})}),s("div",{className:"bembla__controls",children:[s("div",{className:"bembla__buttons",children:[r(ae,{onClick:J,disabled:$}),r(ce,{onClick:T,disabled:H})]}),r(pe,{selectedSnap:q,snapCount:z})]})]}),s("div",{className:"my-8 text-left",children:[r("label",{htmlFor:"cars",children:"مرتب سازی"}),s("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:E,onChange:G,children:[r("option",{value:["created_at","desc"],children:"جدیدترین"}),r("option",{value:["price","asc"],children:"ارزانترین"}),r("option",{value:["price","desc"],children:"گرانترین"})]})]}),r("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:I.map((e,t)=>r(te,{product:e,handleAdd:()=>K(e),handleWish:()=>Q(e)},t))}),r("div",{ref:y,className:"h-12"}),g&&r("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),r("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}he.layout=n=>r(V,{isSingle:!0,children:n});export{he as default};
