import{jsxs as s,jsx as e,Fragment as K}from"react/jsx-runtime";import{F as Q}from"./front-layout-CmMAJVL8.js";import{Link as v,router as x,Head as X}from"@inertiajs/react";import{useState as i,useCallback as Y,useEffect as N,useRef as F}from"react";import{P as Z}from"./product-card-MIyxS9FO.js";import{useCart as $}from"react-use-cart";import{s as L}from"./textarea-input-CS_jPfHL.js";import ee from"./list-sidebar-BJWfzEtt.js";import{u as re,P as te,N as se}from"./carousalArrowButtons-DXZfx4kV.js";import ae from"embla-carousel-react";import le from"embla-carousel-autoplay";import{House as oe,ChevronLeft as ne}from"lucide-react";import"./hooks-CFRBbKAZ.js";import"theme-change";import"./header-single-Dn1o8trq.js";import"./logo-C8A0auOY.js";import"motion/react";import"./button-s_fcD1op.js";import"sonner";import"dayjs";import"./top-nav-D2NhGhC3.js";import"./feature-SAmpyC-7.js";import"./badge-DHrEAO1i.js";import"./MultiRangeSlider-BON0lKoX.js";import"./searchFilter-Cse8n5B7.js";import"@headlessui/react";const ce=a=>{const[t,l]=i(0),[h,g]=i(0),c=Y(u=>{g(u.scrollSnapList().length),l(u.selectedScrollSnap())},[]);return N(()=>{a&&(c(a),a.on("select",c),a.on("reInit",c))},[a,c]),{selectedSnap:t,snapCount:h}},ie=a=>{const{selectedSnap:t,snapCount:l}=a;return s("div",{className:"embla__selected-snap-display",children:[t+1," / ",l]})};function de({items:a=[]}){return e("div",{className:"container pt-4 pb-8",children:s("ul",{className:"breadcrumb flex items-center flex-wrap",children:[e("li",{children:e(v,{href:route("home"),title:"home",children:e(oe,{size:12,color:"#878787"})})}),a.map((t,l)=>s("li",{className:"flex items-center",children:[e("span",{className:"px-2",children:e(ne,{size:12,color:"#878787"})}),e(v,{href:route("home.getCategory",{slug:t.slug}),className:"text-[#d8330a] text-xs",children:t.title})]},l))]})})}function ue(a){const{data:t={},brands:l=null,carBrands:h=null,carModels:g=null,categories:c=null,filters:u=null,productCategory:o,breadcrumbs:j}=a,[M,S]=i(Array.isArray(t.data)?t.data:[]),[m,y]=i(t.next_page_url||null),[f,_]=i(!!t.next_page_url),[p,C]=i(!1),b=F(null),d=F(null);N(()=>{const r=Array.isArray(t.data)?t.data:[];S(r),y(t.next_page_url||null),_(!!t.next_page_url)},[o.slug,route().params.column,route().params.in_stock,route().params.has_promotion,route().params.priceMin,route().params.priceMax,JSON.stringify(route().params.staticFilters),JSON.stringify(route().params.dynamicFilters)]),N(()=>{if(!(!b.current||!f))return d.current&&d.current.disconnect(),d.current=new IntersectionObserver(r=>{r[0].isIntersecting&&!p&&m&&D()},{root:null,rootMargin:"200px",threshold:.1}),d.current.observe(b.current),()=>d.current?.disconnect()},[m,p,f]);const D=()=>{!m||p||!f||(C(!0),x.get(m,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:r=>{const n=r.props?.data?.data||[];S(q=>{const G=[...q,...n],w=new Set;return G.filter(P=>{const k=P?.id??JSON.stringify(P);return w.has(k)?!1:(w.add(k),!0)})}),y(r.props?.data?.next_page_url||null),_(!!r.props?.data?.next_page_url)},onFinish:()=>{C(!1)}}))},{addItem:I}=$(),O=route().params.column||"created_at,desc",[R,B]=ae({align:"start",direction:"rtl",loop:!0},[le()]),{prevBtnDisabled:A,nextBtnDisabled:H,onPrevButtonClick:J,onNextButtonClick:z}=re(B),{selectedSnap:E,snapCount:U}=ce(B),W=r=>{const n=r.target.value;x.get(route(route().current(),o.slug),{...route().params,column:n},{replace:!0,preserveScroll:!0,preserveState:!0})},T=r=>{I({id:r.id,sku:r.sku,title:r.title,excerpt:r.excerpt,discount:r.discount,image:r.image,price:r.price}),L("محصول به سبد خرید اضافه شد","success")},V=r=>{x.post(route("user.wishlists.store"),{item:r},{forceFormData:!0,onSuccess:()=>L("محصول به لیست خرید اضافه شد","success")})};return s(K,{children:[e(X,{title:"محصولات "+o.title}),e(de,{items:j}),e("section",{className:"w-full container justify-center mb-12",children:s("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[e(ee,{brands:l,carBrands:h,carModels:g,categories:c,filters:u,routeParam:o.slug}),s("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[s("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",o.title]}),o.children?.length>0&&s("section",{className:"bembla relative",children:[e("div",{className:"bembla__viewport",ref:R,children:e("div",{className:"bembla__container",children:o.children.map((r,n)=>e("div",{className:"bembla__slide pl-0",children:s("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[e("figure",{children:e("img",{src:r.image?route("file.show",{file:r.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),s("div",{className:"card-body text-center p-1 mt-2",children:[e(v,{href:route("home.getCategory",r.slug),children:e("h2",{className:"card-title justify-center text-sm",children:r.title})}),r.description&&e("p",{children:r.description})]})]})},n))})}),s("div",{className:"bembla__controls",children:[s("div",{className:"bembla__buttons jobjob",children:[e(te,{onClick:J,disabled:A}),e(se,{onClick:z,disabled:H})]}),e(ie,{selectedSnap:E,snapCount:U})]})]}),s("div",{className:"my-8 text-left",children:[e("label",{htmlFor:"cars",children:"مرتب سازی"}),s("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:O,onChange:W,children:[e("option",{value:["created_at","desc"],children:"جدیدترین"}),e("option",{value:["price","asc"],children:"ارزانترین"}),e("option",{value:["price","desc"],children:"گرانترین"})]})]}),e("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:M.map((r,n)=>e(Z,{product:r,handleAdd:()=>T(r),handleWish:()=>V(r)},n))}),e("div",{ref:b,className:"h-12"}),p&&e("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),e("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}ue.layout=a=>e(Q,{isSingle:!0,children:a});export{ue as default};
