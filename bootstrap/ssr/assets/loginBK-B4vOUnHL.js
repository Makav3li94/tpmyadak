import{jsxs as i,jsx as e,Fragment as _}from"react/jsx-runtime";import{useState as o,useEffect as x}from"react";import{G as z}from"./guest-layout-C3yBLsvw.js";import{useForm as J,Head as Q,Link as v,router as T}from"@inertiajs/react";import{T as u,s as w}from"./textarea-input-CXyI_aPO.js";import{B as p}from"./button-s_fcD1op.js";import"sonner";import"theme-change";import"./LandingIntro--Bkw8jbr.js";import"./TemplatePointers-CrKqY3VS.js";import"lucide-react";import"dayjs";function ce({status:U}){const{data:r,setData:y,post:M,processing:N,errors:V,reset:F}=J({mobile:"09",name:"",email:"",code:"",password:""}),[b,j]=o(!1),[B,L]=o(null),[P,C]=o(!1),[g,G]=o(!1),[k,m]=o(null),[H,E]=o(null),[K,S]=o(null),[O,h]=o(null),[W,l]=o(!1),[X,R]=o(""),[n,I]=o(30);x(()=>{let t,c;if(n>0)t=setInterval(()=>I(s=>s-1),1e3);else if(n===0)return;return()=>{clearTimeout(c),clearInterval(t)}},[n]),x(()=>()=>{F("password")},[]),x(()=>{r.code!==null&&r.code.length===4&&D()},[r.code]);const D=t=>{if(r.code===null)return!1;if(h(""),parseInt(B)!==parseInt(q(r.code)))h("کد وارد شده اشتباه است."),l(!0);else return h(null),l(!1),!0},q=t=>t.replace(/[٠-٩۰-۹]/g,c=>c.charCodeAt(0)&15),d=t=>{y(t.target.name,t.target.type==="checkbox"?t.target.checked:t.target.value)},A=t=>{t.code==="Enter"&&M(route("login"))},f=(t,c="login")=>{if(t.preventDefault(),l(!0),m(null),c==="login"||c==="resend")if(I(45),!g||c==="resend")m(null),axios.get(route("phoneStat",{mobile:r.mobile})).then(s=>{if(y("password",""),s.data.user==="True")w("رمز عبور جدید برای شما ارسال شد.","success"),R(s.data.statusMessage),G(!0),l(!1);else if(s.data.user==="False"){if(s.data.sms_active==="yes"){w("کد با موفقیت ارسال شد.","success");let a=(parseInt(s.data.code)-parseInt(r.mobile)*100/2)/1363;console.log(a),L(a)}else j(!0);C(!0),C(!0),l(!1)}if(Object.keys(s.data.errs).length!==0){let a=s.data.errs;a.mobile&&m(a.mobile),l(!1)}}).catch(s=>{console.log(s),l(!1)});else{if(r.password.length!==6){w("لطفا رمز را به درستی وارد کنید.","error");return}T.post(route("login"),{email:r.email,mobile:r.mobile,password:r.password,norm:!0},{onStart:()=>l(!0),onFinish:()=>l(!1),onError:()=>m("شماره همراه یا رمز عبور اشتباه می باشد.")})}else{if(!b&&!D())return!1;m(null),E(null),S(null),axios.post(route("registerPost",{code:r.code,name:r.name,mobile:r.mobile,email:r.email,password:r.password})).then(s=>{if(s.data.status==="success"&&T.visit(route("user.dashboard")),Object.keys(s.data.errs).length!==0){let a=s.data.errs;a.mobile&&m(a.mobile),a.name&&E(a.name),a.email&&S(a.email),a.code&&h(a.code),l(!1)}}).catch(s=>{console.log(s),l(!1)})}};return i(z,{children:[e(Q,{title:"ورود | ثبت نام"}),e("h2",{className:"text-2xl font-semibold mb-2 text-center",children:"ورود | ثبت نام"}),P?i("form",{onSubmit:t=>f(t,"register"),children:[e("div",{className:"mb-4",children:e(u,{type:"text",label:"نام و نام خانوادگی",name:"name",value:r.name,className:"mt-1 block w-full",onChange:d,error:H})}),e("div",{className:"mb-4",children:e(u,{type:"text",label:"ایمیل",name:"email",value:r.email,className:"mt-1 block w-full",onChange:d,error:K})}),!b&&e("div",{className:"mb-4",children:e(u,{type:"code",label:"کدتایید",name:"code",value:r.code,className:"mt-1 block w-full",onChange:d,error:O})}),e(p,{btnType:"submit",processing:N,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ثبت نام"}),b&&i(p,{type:"error",onClick:t=>f(t,"resend"),disabled:n!==0,children:["ارسال مجدد",e("strong",{className:"text-danger mr-2",children:n!==0?n:""})]}),i("div",{className:"text-center mt-4",children:["اکانت ندارید ؟",e(v,{href:route("register"),children:e("span",{className:"  inline-block  hover:text-primary hover:underline hover:cursor-pointer transition duration-200",children:"ثبت نام"})})," کنید."]})]}):i("form",{onSubmit:t=>f(t,"login"),children:[g?i(_,{children:[e("div",{className:"mb-4",children:e(u,{type:"password",label:"رمزعبور",name:"password",dir:"ltr",placeholder:"password",value:r.password,className:"mt-1 block w-full",onChange:d,error:k,onKeyDownCapture:A})}),e("div",{className:"text-right text-primary",children:e(v,{href:route("password.request"),children:e("span",{className:"text-sm  inline-block  hover:text-primary hover:underline hover:cursor-pointer transition duration-200",children:"فراموشی رمز عبور"})})})]}):e("div",{className:"mb-4",children:e(u,{type:"text",label:"موبایل",name:"mobile",placeholder:"+۹۸",pattern:"\\d{11}",value:r.mobile,className:"mt-1 block w-full",dir:"ltr",maxLength:11,autoFocus:!0,onChange:d,error:k})}),g&&i(p,{type:"error",onClick:t=>f(t,"login"),disabled:n!==0,children:["ارسال مجدد",e("strong",{className:"text-danger mr-2",children:n!==0?n:""})]}),e(p,{btnType:"submit",processing:N,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ورود"}),i("div",{className:"text-center mt-4",children:["اکانت ندارید ؟",e(v,{href:route("register"),children:e("span",{className:"  inline-block  hover:text-primary hover:underline hover:cursor-pointer transition duration-200",children:"ثبت نام"})})," کنید."]})]}),e("p",{className:"text-accent-content/70 text-center  text-xs mt-5",children:"با ورود به سایت قوانین و مقررات را میپذیرم."})]})}export{ce as default};
