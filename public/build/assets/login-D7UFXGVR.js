import{h as K,b as r,j as s,H as L,d as V}from"./index-Drr-5sAG.js";import{G as _}from"./guest-layout-Dy1k1Vdp.js";import{a as i,s as g}from"./textarea-input-nUcVDi94.js";import{B as d}from"./button-D1dAOqhP.js";import"./index-DDQ21QUK.js";import"./LandingIntro-yaLTMkEE.js";import"./TemplatePointers-D6WV_4kj.js";import"./createLucideIcon-B95_Wfhm.js";import"./search-4klp1YUx.js";import"./spinner-Dg4AeWrR.js";function te({status:A}){const{data:t,setData:w,post:j,processing:y,errors:f,reset:k}=K({mobile:"09",name:"",email:"",code:"",password:""}),[p,I]=r.useState(!1),[E,M]=r.useState(null),[T,F]=r.useState(!1),[b,B]=r.useState(!1),[S,m]=r.useState(null),[O,h]=r.useState(null),[q,l]=r.useState(!1),[z,D]=r.useState(""),[o,C]=r.useState(30);r.useEffect(()=>{let e,a;if(o>0)e=setInterval(()=>C(n=>n-1),1e3);else if(o===0)return;return()=>{clearTimeout(a),clearInterval(e)}},[o]),r.useEffect(()=>()=>{k("password")},[]),r.useEffect(()=>{t.code!==null&&t.code.length===4&&N()},[t.code]);const N=e=>{if(t.code===null)return!1;if(h(""),parseInt(E)!==parseInt(P(t.code)))h("کد وارد شده اشتباه است."),l(!0);else return h(null),l(!1),!0},P=e=>e.replace(/[٠-٩۰-۹]/g,a=>a.charCodeAt(0)&15),c=e=>{w(e.target.name,e.target.type==="checkbox"?e.target.checked:e.target.value)},R=e=>{e.code==="Enter"&&j(route("login"))},H=e=>{if(w("password",""),e.user==="True"){g("رمز عبور جدید برای شما ارسال شد.","success"),D(e.statusMessage),console.log(e.pass),B(!0);return}if(e.user==="False"){if(e.sms_active==="yes"){g("کد با موفقیت ارسال شد.","success");const a=(parseInt(e.code)-parseInt(t.mobile)*100/2)/1363;console.log(a),M(a)}else I(!0);F(!0)}},x=async(e,a="login")=>{if(e.preventDefault(),l(!0),m(null),a==="login"||a==="resend"){if(C(45),!b||a==="resend")try{m(null);const u=(await axios.get(route("phoneStat",{mobile:t.mobile}))).data;if(H(u),u.errs&&Object.keys(u.errs).length!==0){const v=u.errs;v.mobile&&m(v.mobile)}}catch(n){console.log(n)}finally{l(!1)}else{if(!t.password||t.password.length!==6){g("لطفا رمز را به درستی وارد کنید.","error"),l(!1);return}V.post(route("login"),{email:t.email,mobile:t.mobile,password:t.password,norm:!0},{onStart:()=>l(!0),onFinish:()=>l(!1),onError:()=>m("شماره همراه یا رمز عبور اشتباه می باشد.")})}return}try{if(!p&&!N())return l(!1),!1}catch(n){console.log(n)}finally{l(!1)}},G=e=>{e.preventDefault(),j(route("registerPost",{code:t.code,name:t.name,mobile:t.mobile,email:t.email,password:t.password}))};return s.jsxs(_,{children:[s.jsx(L,{title:"ورود | ثبت نام"}),s.jsx("h2",{className:"text-2xl font-semibold mb-2 text-center",children:"ورود | ثبت نام"}),T?s.jsxs("form",{onSubmit:e=>G(e),children:[s.jsx("div",{className:"mb-4",children:s.jsx(i,{type:"text",label:"نام و نام خانوادگی",name:"name",value:t.name,className:"mt-1 block w-full",onChange:c,error:f.name})}),s.jsx("div",{className:"mb-4",children:s.jsx(i,{type:"text",label:"ایمیل",name:"email",value:t.email,className:"mt-1 block w-full",onChange:c,error:f.email})}),!p&&s.jsx("div",{className:"mb-4",children:s.jsx(i,{type:"code",label:"کدتایید",name:"code",value:t.code,className:"mt-1 block w-full",onChange:c,error:f.code})}),s.jsx(d,{btnType:"submit",processing:y,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ثبت نام"}),!p&&s.jsxs(d,{type:"error",className:"btn mt-5 w-full ",onClick:e=>x(e,"resend"),disabled:o!==0,children:["ارسال مجدد پیامک",s.jsx("strong",{className:"text-danger mr-2",children:o!==0?o:""})]})]}):s.jsxs("form",{onSubmit:e=>x(e,"login"),children:[b?s.jsx(s.Fragment,{children:s.jsx("div",{className:"mb-4",children:s.jsx(i,{type:"password",label:"رمزعبور",name:"password",dir:"ltr",placeholder:"password",value:t.password,className:"mt-1 block w-full",onChange:c,error:S,onKeyDownCapture:R})})}):s.jsx("div",{className:"mb-4",children:s.jsx(i,{type:"text",label:"موبایل",name:"mobile",placeholder:"+۹۸",pattern:"\\d{11}",value:t.mobile,className:"mt-1 block w-full",dir:"ltr",maxLength:11,autoFocus:!0,onChange:c,error:S})}),s.jsx(d,{btnType:"submit",processing:y,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ورود"}),b&&s.jsxs(d,{type:"error",className:"btn mt-5 w-full ",onClick:e=>x(e,"login"),disabled:o!==0,children:["ارسال مجدد پیامک",s.jsx("strong",{className:"text-danger mr-2",children:o!==0?o:""})]})]}),s.jsx("p",{className:" text-center  text-xs mt-5",children:"با ورود به سایت قوانین و مقررات را میپذیرم."})]})}export{te as default};
