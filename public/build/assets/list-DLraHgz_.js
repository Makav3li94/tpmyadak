import{b as r,j as e,d as f,H as T,L as V}from"./index-DDca1aiV.js";import{F as q}from"./front-layout-W3mdR8XK.js";import{P as z}from"./product-card-Cqb3-xLJ.js";import{u as G}from"./react-use-cart.esm-B9s7uaXZ.js";import{s as B}from"./textarea-input-Bmdp0oLw.js";import{B as K}from"./breadcrumb-B672qKnU.js";import Q from"./list-sidebar-Dg7Aaxc3.js";import{u as X,P as Y,N as Z,A as $}from"./embla-carousel-autoplay.esm-CKD3EjSa.js";import{u as ee}from"./embla-carousel-react.esm-BQsc_tkz.js";import"./hooks-C1aZXtTk.js";import"./index-DDQ21QUK.js";import"./header-single-b2viebMN.js";import"./createLucideIcon-RXBZCcM_.js";import"./theme-switch-CeGAbILo.js";import"./logo-C8A0auOY.js";import"./search-myPFLCWv.js";import"./x-C5pP27M6.js";import"./button-XQ7iUB_I.js";import"./spinner-D5QHHuo0.js";import"./plus-J8VVJKn2.js";import"./minus-CTVTFXQ9.js";import"./top-nav-8gEPz3yY.js";import"./chevron-left-DQg-zfff.js";import"./feature-BpqMX5rT.js";import"./car-DkodfHbk.js";import"./badge-lgw6TIeh.js";import"./MultiRangeSlider--SxZIZPX.js";import"./searchFilter-ZwN2ByKv.js";import"./disclosure-CyuM4fQs.js";import"./open-closed-YwrQiBCr.js";const te=a=>{const[s,c]=r.useState(0),[m,x]=r.useState(0),n=r.useCallback(d=>{x(d.scrollSnapList().length),c(d.selectedScrollSnap())},[]);return r.useEffect(()=>{a&&(n(a),a.on("select",n),a.on("reInit",n))},[a,n]),{selectedSnap:s,snapCount:m}},se=a=>{const{selectedSnap:s,snapCount:c}=a;return e.jsxs("div",{className:"embla__selected-snap-display",children:[s+1," / ",c]})};function re(a){const{data:s={},brands:c=null,carBrands:m=null,carModels:x=null,categories:n=null,filters:d=null,productCategory:o}=a,[w,j]=r.useState(Array.isArray(s.data)?s.data:[]),[u,b]=r.useState(s.next_page_url||null),[g,S]=r.useState(!!s.next_page_url),[p,v]=r.useState(!1),h=r.useRef(null),i=r.useRef(null);r.useEffect(()=>{const t=Array.isArray(s.data)?s.data:[];j(t),b(s.next_page_url||null),S(!!s.next_page_url)},[o.slug,route().params.column,route().params.in_stock,route().params.has_promotion,route().params.priceMin,route().params.priceMax,JSON.stringify(route().params.staticFilters),JSON.stringify(route().params.dynamicFilters)]),r.useEffect(()=>{if(!(!h.current||!g))return i.current&&i.current.disconnect(),i.current=new IntersectionObserver(t=>{t[0].isIntersecting&&!p&&u&&P()},{root:null,rootMargin:"200px",threshold:.1}),i.current.observe(h.current),()=>i.current?.disconnect()},[u,p,g]);const P=()=>{!u||p||!g||(v(!0),f.get(u,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:t=>{const l=t.props?.data?.data||[];j(U=>{const W=[...U,...l],N=new Set;return W.filter(y=>{const C=y?.id??JSON.stringify(y);return N.has(C)?!1:(N.add(C),!0)})}),b(t.props?.data?.next_page_url||null),S(!!t.props?.data?.next_page_url)},onFinish:()=>{v(!1)}}))},{addItem:k}=G(),F=route().params.column||"created_at,desc",[L,_]=ee({align:"start",direction:"rtl",loop:!0},[$()]),{prevBtnDisabled:M,nextBtnDisabled:E,onPrevButtonClick:R,onNextButtonClick:D}=X(_),{selectedSnap:I,snapCount:A}=te(_),O=t=>{const l=t.target.value;f.get(route(route().current(),o.slug),{...route().params,column:l},{replace:!0,preserveScroll:!0,preserveState:!0})},H=t=>{k({id:t.id,sku:t.sku,title:t.title,excerpt:t.excerpt,discount:t.discount,image:t.image,price:t.price}),B("محصول به سبد خرید اضافه شد","success")},J=t=>{f.post(route("user.wishlists.store"),{item:t},{forceFormData:!0,onSuccess:()=>B("محصول به لیست خرید اضافه شد","success")})};return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"محصولات "+o.title}),e.jsx(K,{l1:["دسته بندی",""],l2:[o.title,""]}),e.jsx("section",{className:"w-full container justify-center mb-12",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[e.jsx(Q,{brands:c,carBrands:m,carModels:x,categories:n,filters:d,routeParam:o.slug}),e.jsxs("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[e.jsxs("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",o.title]}),o.children?.length>0&&e.jsxs("section",{className:"bembla relative",children:[e.jsx("div",{className:"bembla__viewport",ref:L,children:e.jsx("div",{className:"bembla__container",children:o.children.map((t,l)=>e.jsx("div",{className:"bembla__slide pl-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[e.jsx("figure",{children:e.jsx("img",{src:t.image?route("file.show",{file:t.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),e.jsxs("div",{className:"card-body text-center p-1 mt-2",children:[e.jsx(V,{href:route("home.getCategory",t.slug),children:e.jsx("h2",{className:"card-title justify-center text-sm",children:t.title})}),t.description&&e.jsx("p",{children:t.description})]})]})},l))})}),e.jsxs("div",{className:"bembla__controls",children:[e.jsxs("div",{className:"bembla__buttons jobjob",children:[e.jsx(Y,{onClick:R,disabled:M}),e.jsx(Z,{onClick:D,disabled:E})]}),e.jsx(se,{selectedSnap:I,snapCount:A})]})]}),e.jsxs("div",{className:"my-8 text-left",children:[e.jsx("label",{htmlFor:"cars",children:"مرتب سازی"}),e.jsxs("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:F,onChange:O,children:[e.jsx("option",{value:["created_at","desc"],children:"جدیدترین"}),e.jsx("option",{value:["price","asc"],children:"ارزانترین"}),e.jsx("option",{value:["price","desc"],children:"گرانترین"})]})]}),e.jsx("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:w.map((t,l)=>e.jsx(z,{product:t,handleAdd:()=>H(t),handleWish:()=>J(t)},l))}),e.jsx("div",{ref:h,className:"h-12"}),p&&e.jsx("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),e.jsx("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}re.layout=a=>e.jsx(q,{isSingle:!0,children:a});export{re as default};
