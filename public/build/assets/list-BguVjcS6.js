import{b as s,j as e,d as N,L as Q}from"./index-DDca1aiV.js";import{F as X}from"./front-layout-BPGPo8bh.js";import{P as Y}from"./product-card-C_Qyd9fr.js";import{u as Z}from"./react-use-cart.esm-B9s7uaXZ.js";import{s as L}from"./textarea-input-Bmdp0oLw.js";import{B as V}from"./breadcrumb-B672qKnU.js";import ee from"./list-sidebar-BF0tVnVL.js";import{u as te,P as re,N as se,A as ne}from"./embla-carousel-autoplay.esm-CKD3EjSa.js";import{u as ae}from"./embla-carousel-react.esm-BQsc_tkz.js";import"./hooks-C1aZXtTk.js";import"./index-DDQ21QUK.js";import"./header-single-DAWPt8It.js";import"./createLucideIcon-RXBZCcM_.js";import"./theme-switch-CeGAbILo.js";import"./logo-C8A0auOY.js";import"./search-myPFLCWv.js";import"./x-C5pP27M6.js";import"./button-XQ7iUB_I.js";import"./spinner-D5QHHuo0.js";import"./plus-J8VVJKn2.js";import"./minus-CTVTFXQ9.js";import"./megu-menu-fyvL7Vaj.js";import"./chevron-left-DQg-zfff.js";import"./feature-Cn3oYtY8.js";import"./car-DkodfHbk.js";import"./badge-lgw6TIeh.js";import"./MultiRangeSlider--SxZIZPX.js";import"./searchFilter-CKj4n8oj.js";import"./open-closed-YwrQiBCr.js";const le=n=>{const[a,d]=s.useState(0),[h,g]=s.useState(0),l=s.useCallback(p=>{g(p.scrollSnapList().length),d(p.selectedScrollSnap())},[]);return s.useEffect(()=>{n&&(l(n),n.on("select",l),n.on("reInit",l))},[n,l]),{selectedSnap:a,snapCount:h}},oe=n=>{const{selectedSnap:a,snapCount:d}=n;return e.jsxs("div",{className:"embla__selected-snap-display",children:[a+1," / ",d]})};function ce(n){const{data:a={},brands:d=null,carBrands:h=null,carModels:g=null,categories:l=null,filters:p=null,productCategory:o}=n,k=Array.isArray(a.data)?a.data:[],j=a.next_page_url??null,b=a.next_cursor??null,[R,F]=s.useState(k),[x,c]=s.useState(null),[f,y]=s.useState(!1),[S,i]=s.useState(!!(j||b)),v=s.useRef(null),u=s.useRef(null);function _(t){if(!t)return null;const r=new URL(window.location.href),m=new URLSearchParams(r.search);return m.delete("cursor"),m.set("cursor",t),`${r.pathname}?${m.toString()}`}s.useEffect(()=>{if(j){c(j),i(!0);return}if(b){c(_(b)),i(!0);return}c(null),i(!1)},[]),s.useEffect(()=>{if(!(!v.current||!S))return u.current&&u.current.disconnect(),u.current=new IntersectionObserver(t=>{t[0].isIntersecting&&!f&&x&&E()},{root:null,rootMargin:"200px",threshold:.1}),u.current.observe(v.current),()=>u.current?.disconnect()},[x,f,S]);const E=()=>{!x||f||!S||(y(!0),N.get(x,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:t=>{const r=t.props?.data??{},m=Array.isArray(r.data)?r.data:[];F(G=>{const K=[...G,...m],w=new Set;return K.filter(P=>{const B=P?.id??JSON.stringify(P);return w.has(B)?!1:(w.add(B),!0)})}),r.next_page_url?(c(r.next_page_url),i(!0)):r.next_cursor?(c(_(r.next_cursor)),i(!0)):(c(null),i(!1))},onFinish:()=>y(!1)}))},{addItem:U}=Z(),[D,I]=s.useState(""),[M,C]=ae({align:"start",direction:"rtl",loop:!0},[ne()]),{prevBtnDisabled:A,nextBtnDisabled:O,onPrevButtonClick:W,onNextButtonClick:$}=te(C),{selectedSnap:H,snapCount:J}=le(C),T=t=>{I(t.target.value),N.get(route(route().current(),o.slug),{column:t.target.value},{replace:!0,preserveState:!0,preserveScroll:!0})},q=t=>{U({id:t.id,sku:t.sku,title:t.title,excerpt:t.excerpt,discount:t.discount,image:t.image,price:t.price}),L("محصول به سبد خرید اضافه شد","success")},z=t=>{N.post(route("user.wishlists.store"),{item:t},{forceFormData:!0,onSuccess:()=>L("محصول به لیست خرید اضافه شد","success")})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{l1:["دسته بندی",""],l2:[o.title,""]}),e.jsx("section",{className:"w-full container justify-center mb-12",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[e.jsx(ee,{brands:d,carBrands:h,carModels:g,categories:l,filters:p,routeParam:o.slug}),e.jsxs("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[e.jsxs("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",o.title]}),o.children?.length>0&&e.jsxs("section",{className:"bembla relative",children:[e.jsx("div",{className:"bembla__viewport",ref:M,children:e.jsx("div",{className:"bembla__container",children:o.children.map((t,r)=>e.jsx("div",{className:"bembla__slide pl-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[e.jsx("figure",{children:e.jsx("img",{src:t.image?route("file.show",{file:t.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),e.jsxs("div",{className:"card-body text-center p-1 mt-2",children:[e.jsx(Q,{href:route("home.getCategory",t.slug),children:e.jsx("h2",{className:"card-title justify-center text-sm",children:t.title})}),t.description&&e.jsx("p",{children:t.description})]})]})},r))})}),e.jsxs("div",{className:"bembla__controls",children:[e.jsxs("div",{className:"bembla__buttons jobjob",children:[e.jsx(re,{onClick:W,disabled:A}),e.jsx(se,{onClick:$,disabled:O})]}),e.jsx(oe,{selectedSnap:H,snapCount:J})]})]}),e.jsxs("div",{className:"my-8 text-left",children:[e.jsx("label",{htmlFor:"cars",children:"مرتب سازی"}),e.jsxs("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:D,onChange:T,children:[e.jsx("option",{value:["created_at","desc"],children:"جدیدترین"}),e.jsx("option",{value:["price","asc"],children:"ارزانترین"}),e.jsx("option",{value:["price","desc"],children:"گرانترین"})]})]}),e.jsx("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:R.map((t,r)=>e.jsx(Y,{product:t,handleAdd:()=>q(t),handleWish:()=>z(t)},r))}),e.jsx("div",{ref:v,className:"h-12"}),f&&e.jsx("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),e.jsx("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}ce.layout=n=>e.jsx(X,{isSingle:!0,children:n});export{ce as default};
