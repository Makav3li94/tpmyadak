import{b as s,j as e,d as N,H as Q,L as X}from"./index-DDca1aiV.js";import{F as Y}from"./front-layout-BnrMffXA.js";import{P as Z}from"./product-card-C_Qyd9fr.js";import{u as V}from"./react-use-cart.esm-B9s7uaXZ.js";import{s as L}from"./textarea-input-Bmdp0oLw.js";import{B as ee}from"./breadcrumb-B672qKnU.js";import te from"./list-sidebar-B3C6vx4d.js";import{u as re,P as se,N as ae,A as ne}from"./embla-carousel-autoplay.esm-CKD3EjSa.js";import{u as le}from"./embla-carousel-react.esm-BQsc_tkz.js";import"./hooks-C1aZXtTk.js";import"./index-DDQ21QUK.js";import"./header-single-Dbib8A9s.js";import"./createLucideIcon-RXBZCcM_.js";import"./theme-switch-CeGAbILo.js";import"./logo-C8A0auOY.js";import"./search-myPFLCWv.js";import"./x-C5pP27M6.js";import"./button-XQ7iUB_I.js";import"./spinner-D5QHHuo0.js";import"./plus-J8VVJKn2.js";import"./minus-CTVTFXQ9.js";import"./top-nav-LkNvT7my.js";import"./chevron-left-DQg-zfff.js";import"./feature-Cn3oYtY8.js";import"./car-DkodfHbk.js";import"./badge-lgw6TIeh.js";import"./MultiRangeSlider--SxZIZPX.js";import"./searchFilter-CKj4n8oj.js";import"./disclosure-CyuM4fQs.js";import"./open-closed-YwrQiBCr.js";const oe=a=>{const[n,d]=s.useState(0),[h,g]=s.useState(0),o=s.useCallback(p=>{g(p.scrollSnapList().length),d(p.selectedScrollSnap())},[]);return s.useEffect(()=>{a&&(o(a),a.on("select",o),a.on("reInit",o))},[a,o]),{selectedSnap:n,snapCount:h}},ce=a=>{const{selectedSnap:n,snapCount:d}=a;return e.jsxs("div",{className:"embla__selected-snap-display",children:[n+1," / ",d]})};function ie(a){const{data:n={},brands:d=null,carBrands:h=null,carModels:g=null,categories:o=null,filters:p=null,productCategory:l}=a,k=Array.isArray(n.data)?n.data:[],j=n.next_page_url??null,b=n.next_cursor??null,[R,F]=s.useState(k),[x,c]=s.useState(null),[f,y]=s.useState(!1),[S,i]=s.useState(!!(j||b)),v=s.useRef(null),u=s.useRef(null);function _(t){if(!t)return null;const r=new URL(window.location.href),m=new URLSearchParams(r.search);return m.delete("cursor"),m.set("cursor",t),`${r.pathname}?${m.toString()}`}s.useEffect(()=>{if(j){c(j),i(!0);return}if(b){c(_(b)),i(!0);return}c(null),i(!1)},[]),s.useEffect(()=>{if(!(!v.current||!S))return u.current&&u.current.disconnect(),u.current=new IntersectionObserver(t=>{t[0].isIntersecting&&!f&&x&&E()},{root:null,rootMargin:"200px",threshold:.1}),u.current.observe(v.current),()=>u.current?.disconnect()},[x,f,S]);const E=()=>{!x||f||!S||(y(!0),N.get(x,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:t=>{const r=t.props?.data??{},m=Array.isArray(r.data)?r.data:[];F(G=>{const K=[...G,...m],w=new Set;return K.filter(P=>{const B=P?.id??JSON.stringify(P);return w.has(B)?!1:(w.add(B),!0)})}),r.next_page_url?(c(r.next_page_url),i(!0)):r.next_cursor?(c(_(r.next_cursor)),i(!0)):(c(null),i(!1))},onFinish:()=>y(!1)}))},{addItem:U}=V(),[D,I]=s.useState(""),[M,C]=le({align:"start",direction:"rtl",loop:!0},[ne()]),{prevBtnDisabled:A,nextBtnDisabled:H,onPrevButtonClick:O,onNextButtonClick:W}=re(C),{selectedSnap:$,snapCount:J}=oe(C),T=t=>{I(t.target.value),N.get(route(route().current(),l.slug),{column:t.target.value},{replace:!0,preserveState:!0,preserveScroll:!0})},q=t=>{U({id:t.id,sku:t.sku,title:t.title,excerpt:t.excerpt,discount:t.discount,image:t.image,price:t.price}),L("محصول به سبد خرید اضافه شد","success")},z=t=>{N.post(route("user.wishlists.store"),{item:t},{forceFormData:!0,onSuccess:()=>L("محصول به لیست خرید اضافه شد","success")})};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:"محصولات "+l.title}),e.jsx(ee,{l1:["دسته بندی",""],l2:[l.title,""]}),e.jsx("section",{className:"w-full container justify-center mb-12",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[e.jsx(te,{brands:d,carBrands:h,carModels:g,categories:o,filters:p,routeParam:l.slug}),e.jsxs("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[e.jsxs("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",l.title]}),l.children?.length>0&&e.jsxs("section",{className:"bembla relative",children:[e.jsx("div",{className:"bembla__viewport",ref:M,children:e.jsx("div",{className:"bembla__container",children:l.children.map((t,r)=>e.jsx("div",{className:"bembla__slide pl-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[e.jsx("figure",{children:e.jsx("img",{src:t.image?route("file.show",{file:t.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),e.jsxs("div",{className:"card-body text-center p-1 mt-2",children:[e.jsx(X,{href:route("home.getCategory",t.slug),children:e.jsx("h2",{className:"card-title justify-center text-sm",children:t.title})}),t.description&&e.jsx("p",{children:t.description})]})]})},r))})}),e.jsxs("div",{className:"bembla__controls",children:[e.jsxs("div",{className:"bembla__buttons jobjob",children:[e.jsx(se,{onClick:O,disabled:A}),e.jsx(ae,{onClick:W,disabled:H})]}),e.jsx(ce,{selectedSnap:$,snapCount:J})]})]}),e.jsxs("div",{className:"my-8 text-left",children:[e.jsx("label",{htmlFor:"cars",children:"مرتب سازی"}),e.jsxs("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:D,onChange:T,children:[e.jsx("option",{value:["created_at","desc"],children:"جدیدترین"}),e.jsx("option",{value:["price","asc"],children:"ارزانترین"}),e.jsx("option",{value:["price","desc"],children:"گرانترین"})]})]}),e.jsx("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:R.map((t,r)=>e.jsx(Z,{product:t,handleAdd:()=>q(t),handleWish:()=>z(t)},r))}),e.jsx("div",{ref:v,className:"h-12"}),f&&e.jsx("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),e.jsx("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}ie.layout=a=>e.jsx(Y,{isSingle:!0,children:a});export{ie as default};
