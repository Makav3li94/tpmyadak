import{b as a,j as e,L as j,d as g,H as V}from"./index-Drr-5sAG.js";import{F as q}from"./front-layout-BwOJlT13.js";import{P as G}from"./product-card-BrU5fZ8_.js";import{u as K}from"./react-use-cart.esm-BK2AJsdX.js";import{s as w}from"./textarea-input-nUcVDi94.js";import Q from"./list-sidebar-BgGYSAnp.js";import{u as X,P as Y,N as Z,A as $}from"./embla-carousel-autoplay.esm-kN9YOGTe.js";import{u as ee}from"./embla-carousel-react.esm-DClLqNA9.js";import{H as se}from"./house-CIrU1SN5.js";import{C as re}from"./chevron-left-CS-KWwWV.js";import"./hooks-BQCqLFYh.js";import"./index-DDQ21QUK.js";import"./header-single-D2FHqyU4.js";import"./createLucideIcon-B95_Wfhm.js";import"./theme-switch-B4ARlo4z.js";import"./logo-C8A0auOY.js";import"./search-4klp1YUx.js";import"./x-9agbjimF.js";import"./button-D1dAOqhP.js";import"./spinner-Dg4AeWrR.js";import"./plus-w6ZcVm0R.js";import"./minus-CALS6PBj.js";import"./top-nav-BH9j95fP.js";import"./feature-61_ASdhj.js";import"./car-SMeuGASo.js";import"./badge-BZjrrpmY.js";import"./MultiRangeSlider-BADxUAPg.js";import"./searchFilter-DSAxLs-e.js";import"./disclosure-DGbg0Qlw.js";import"./open-closed-BMzgsbC3.js";const te=t=>{const[r,l]=a.useState(0),[p,x]=a.useState(0),c=a.useCallback(d=>{x(d.scrollSnapList().length),l(d.selectedScrollSnap())},[]);return a.useEffect(()=>{t&&(c(t),t.on("select",c),t.on("reInit",c))},[t,c]),{selectedSnap:r,snapCount:p}},ae=t=>{const{selectedSnap:r,snapCount:l}=t;return e.jsxs("div",{className:"embla__selected-snap-display",children:[r+1," / ",l]})};function le({items:t=[]}){return e.jsx("div",{className:"container pt-4 pb-8",children:e.jsxs("ul",{className:"breadcrumb flex items-center flex-wrap",children:[e.jsx("li",{children:e.jsx(j,{href:route("home"),title:"home",children:e.jsx(se,{size:12,color:"#878787"})})}),t.map((r,l)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"px-2",children:e.jsx(re,{size:12,color:"#878787"})}),e.jsx(j,{href:route("home.getCategory",{slug:r.slug}),className:"text-[#d8330a] text-xs",children:r.title})]},l))]})})}function oe(t){const{data:r={},brands:l=null,carBrands:p=null,carModels:x=null,categories:c=null,filters:d=null,productCategory:o,breadcrumbs:P}=t,[k,b]=a.useState(Array.isArray(r.data)?r.data:[]),[u,v]=a.useState(r.next_page_url||null),[h,S]=a.useState(!!r.next_page_url),[m,N]=a.useState(!1),f=a.useRef(null),i=a.useRef(null);a.useEffect(()=>{const s=Array.isArray(r.data)?r.data:[];b(s),v(r.next_page_url||null),S(!!r.next_page_url)},[o.slug,route().params.column,route().params.in_stock,route().params.has_promotion,route().params.priceMin,route().params.priceMax,JSON.stringify(route().params.staticFilters),JSON.stringify(route().params.dynamicFilters)]),a.useEffect(()=>{if(!(!f.current||!h))return i.current&&i.current.disconnect(),i.current=new IntersectionObserver(s=>{s[0].isIntersecting&&!m&&u&&L()},{root:null,rootMargin:"200px",threshold:.1}),i.current.observe(f.current),()=>i.current?.disconnect()},[u,m,h]);const L=()=>{!u||m||!h||(N(!0),g.get(u,{},{preserveScroll:!0,preserveState:!0,only:["data"],onSuccess:s=>{const n=s.props?.data?.data||[];b(W=>{const T=[...W,...n],y=new Set;return T.filter(C=>{const B=C?.id??JSON.stringify(C);return y.has(B)?!1:(y.add(B),!0)})}),v(s.props?.data?.next_page_url||null),S(!!s.props?.data?.next_page_url)},onFinish:()=>{N(!1)}}))},{addItem:F}=K(),M=route().params.column||"created_at,desc",[E,_]=ee({align:"start",direction:"rtl",loop:!0},[$()]),{prevBtnDisabled:R,nextBtnDisabled:D,onPrevButtonClick:H,onNextButtonClick:I}=X(_),{selectedSnap:A,snapCount:O}=te(_),J=s=>{const n=s.target.value;g.get(route(route().current(),o.slug),{...route().params,column:n},{replace:!0,preserveScroll:!0,preserveState:!0})},z=s=>{F({id:s.id,sku:s.sku,title:s.title,excerpt:s.excerpt,discount:s.discount,image:s.image,price:s.price}),w("محصول به سبد خرید اضافه شد","success")},U=s=>{g.post(route("user.wishlists.store"),{item:s},{forceFormData:!0,onSuccess:()=>w("محصول به لیست خرید اضافه شد","success")})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"محصولات "+o.title}),e.jsx(le,{items:P}),e.jsx("section",{className:"w-full container justify-center mb-12",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 md:gap-x-2 lg:gap-x-8 xl:gap-x-10",children:[e.jsx(Q,{brands:l,carBrands:p,carModels:x,categories:c,filters:d,routeParam:o.slug}),e.jsxs("div",{className:"md:col-span-8 lg:col-span-9 mt-6 md:mt-0",children:[e.jsxs("h2",{className:"font-bold text-2xl pb-6",children:["زیردسته های موجود در : ",o.title]}),o.children?.length>0&&e.jsxs("section",{className:"bembla relative",children:[e.jsx("div",{className:"bembla__viewport",ref:E,children:e.jsx("div",{className:"bembla__container",children:o.children.map((s,n)=>e.jsx("div",{className:"bembla__slide pl-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center border-r border-gray-600 p-1",children:[e.jsx("figure",{children:e.jsx("img",{src:s.image?route("file.show",{file:s.image,dir:"category/"}):"/thumbnail.webp",className:"h-22",alt:"slide"})}),e.jsxs("div",{className:"card-body text-center p-1 mt-2",children:[e.jsx(j,{href:route("home.getCategory",s.slug),children:e.jsx("h2",{className:"card-title justify-center text-sm",children:s.title})}),s.description&&e.jsx("p",{children:s.description})]})]})},n))})}),e.jsxs("div",{className:"bembla__controls",children:[e.jsxs("div",{className:"bembla__buttons jobjob",children:[e.jsx(Y,{onClick:H,disabled:R}),e.jsx(Z,{onClick:I,disabled:D})]}),e.jsx(ae,{selectedSnap:A,snapCount:O})]})]}),e.jsxs("div",{className:"my-8 text-left",children:[e.jsx("label",{htmlFor:"cars",children:"مرتب سازی"}),e.jsxs("select",{name:"cars",id:"cars",className:"border-[1px] border-gray-300 px-1 mx-2",value:M,onChange:J,children:[e.jsx("option",{value:["created_at","desc"],children:"جدیدترین"}),e.jsx("option",{value:["price","asc"],children:"ارزانترین"}),e.jsx("option",{value:["price","desc"],children:"گرانترین"})]})]}),e.jsx("div",{className:"-mx-px grid grid-cols-1 border-l border-gray-200 sm:mx-0 sm:grid-cols-2 lg:grid-cols-4",children:k.map((s,n)=>e.jsx(G,{product:s,handleAdd:()=>z(s),handleWish:()=>U(s)},n))}),e.jsx("div",{ref:f,className:"h-12"}),m&&e.jsx("div",{className:"text-center py-4",children:"در حال بارگذاری..."}),e.jsx("div",{className:"border-[1px] border-gray-200 mt-8"})]})]})})]})}oe.layout=t=>e.jsx(q,{isSingle:!0,children:t});export{oe as default};
