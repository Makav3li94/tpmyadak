import{u as A,j as s,H as q,r as v}from"./app-D0BZgUMB.js";import{b as r}from"./sonner-BFuyfz86.js";import{G as z}from"./guest-layout-sS39zqjF.js";import{a as d,s as g}from"./textarea-input-BMCHLsN1.js";import{B as b}from"./button-BtZhFir6.js";import"./lodash-BLbb6PWm.js";/* empty css            */import"./index-DDQ21QUK.js";import"./LandingIntro-DPWitv3G.js";import"./TemplatePointers-CpeWPFuK.js";import"./createLucideIcon-Bo3pdkBr.js";import"./search-CWFc_Glu.js";import"./dayjs-B2iisHW2.js";function ie({status:J}){const{data:t,setData:w,post:k,processing:E,errors:Q,reset:I}=A({mobile:"09",name:"",email:"",code:"",password:""}),[h,M]=r.useState(!1),[T,F]=r.useState(null),[B,D]=r.useState(!1),[x,P]=r.useState(!1),[j,m]=r.useState(null),[R,y]=r.useState(null),[H,N]=r.useState(null),[G,f]=r.useState(null),[K,o]=r.useState(!1),[U,L]=r.useState(""),[n,S]=r.useState(30);r.useEffect(()=>{let e,l;if(n>0)e=setInterval(()=>S(c=>c-1),1e3);else if(n===0)return;return()=>{clearTimeout(l),clearInterval(e)}},[n]),r.useEffect(()=>()=>{I("password")},[]),r.useEffect(()=>{t.code!==null&&t.code.length===4&&C()},[t.code]);const C=e=>{if(t.code===null)return!1;if(f(""),parseInt(T)!==parseInt(O(t.code)))f("کد وارد شده اشتباه است."),o(!0);else return f(null),o(!1),!0},O=e=>e.replace(/[٠-٩۰-۹]/g,l=>l.charCodeAt(0)&15),u=e=>{w(e.target.name,e.target.type==="checkbox"?e.target.checked:e.target.value)},V=e=>{e.code==="Enter"&&k(route("login"))},_=e=>{if(w("password",""),e.user==="True"){g("رمز عبور جدید برای شما ارسال شد.","success"),L(e.statusMessage),console.log(e.pass),P(!0);return}if(e.user==="False"){if(e.sms_active==="yes"){g("کد با موفقیت ارسال شد.","success");const l=(parseInt(e.code)-parseInt(t.mobile)*100/2)/1363;console.log(l),F(l)}else M(!0);D(!0)}},p=async(e,l="login")=>{if(e.preventDefault(),o(!0),m(null),l==="login"||l==="resend"){if(S(45),!x||l==="resend")try{m(null);const i=(await axios.get(route("phoneStat",{mobile:t.mobile}))).data;if(_(i),i.errs&&Object.keys(i.errs).length!==0){const a=i.errs;a.mobile&&m(a.mobile)}}catch(c){console.log(c)}finally{o(!1)}else{if(!t.password||t.password.length!==6){g("لطفا رمز را به درستی وارد کنید.","error"),o(!1);return}v.post(route("login"),{email:t.email,mobile:t.mobile,password:t.password,norm:!0},{onStart:()=>o(!0),onFinish:()=>o(!1),onError:()=>m("شماره همراه یا رمز عبور اشتباه می باشد.")})}return}try{if(!h&&!C())return o(!1),!1;m(null),y(null),N(null);const i=(await axios.post(route("registerPost"),{code:t.code,name:t.name,mobile:t.mobile,email:t.email,password:t.password})).data;if(i.status==="success"){v.visit(route("user.dashboard"));return}if(i.errs&&Object.keys(i.errs).length!==0){const a=i.errs;a.mobile&&m(a.mobile),a.name&&y(a.name),a.email&&N(a.email),a.code&&f(a.code)}}catch(c){console.log(c)}finally{o(!1)}};return s.jsxs(z,{children:[s.jsx(q,{title:"ورود | ثبت نام"}),s.jsx("h2",{className:"text-2xl font-semibold mb-2 text-center",children:"ورود | ثبت نام"}),B?s.jsxs("form",{onSubmit:e=>p(e,"register"),children:[s.jsx("div",{className:"mb-4",children:s.jsx(d,{type:"text",label:"نام و نام خانوادگی",name:"name",value:t.name,className:"mt-1 block w-full",onChange:u,error:R})}),s.jsx("div",{className:"mb-4",children:s.jsx(d,{type:"text",label:"ایمیل",name:"email",value:t.email,className:"mt-1 block w-full",onChange:u,error:H})}),!h&&s.jsx("div",{className:"mb-4",children:s.jsx(d,{type:"code",label:"کدتایید",name:"code",value:t.code,className:"mt-1 block w-full",onChange:u,error:G})}),s.jsx(b,{btnType:"submit",processing:K,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ثبت نام"}),!h&&s.jsxs(b,{type:"error",className:"btn mt-5 w-full ",onClick:e=>p(e,"resend"),disabled:n!==0,children:["ارسال مجدد پیامک",s.jsx("strong",{className:"text-danger mr-2",children:n!==0?n:""})]})]}):s.jsxs("form",{onSubmit:e=>p(e,"login"),children:[x?s.jsx(s.Fragment,{children:s.jsx("div",{className:"mb-4",children:s.jsx(d,{type:"password",label:"رمزعبور",name:"password",dir:"ltr",placeholder:"password",value:t.password,className:"mt-1 block w-full",onChange:u,error:j,onKeyDownCapture:V})})}):s.jsx("div",{className:"mb-4",children:s.jsx(d,{type:"text",label:"موبایل",name:"mobile",placeholder:"+۹۸",pattern:"\\d{11}",value:t.mobile,className:"mt-1 block w-full",dir:"ltr",maxLength:11,autoFocus:!0,onChange:u,error:j})}),s.jsx(b,{btnType:"submit",processing:E,type:"primary",className:"btn mt-2 w-full btn-primary",children:"ورود"}),x&&s.jsxs(b,{type:"error",className:"btn mt-5 w-full ",onClick:e=>p(e,"login"),disabled:n!==0,children:["ارسال مجدد پیامک",s.jsx("strong",{className:"text-danger mr-2",children:n!==0?n:""})]})]}),s.jsx("p",{className:"text-accent-content/70 text-center  text-xs mt-5",children:"با ورود به سایت قوانین و مقررات را میپذیرم."})]})}export{ie as default};
